<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Simulador de Paneo - Web Version</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>body{font-family:'Arial',sans-serif;overflow:hidden;user-select:none}input[type=range]{-webkit-appearance:none;background:0 0}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:#3b82f6;cursor:pointer;margin-top:-6px;box-shadow:0 1px 3px rgba(0,0,0,.3)}input[type=range]::-webkit-slider-runnable-track{width:100%;height:4px;cursor:pointer;background:#cbd5e1;border-radius:2px}.slider-vertical{writing-mode:bt-lr;-webkit-appearance:slider-vertical;width:8px;height:200px;padding:0 5px}.meter-container{width:16px;height:200px;background:#e2e8f0;border-radius:4px;position:relative;overflow:hidden;border:1px solid #94a3b8}.meter-fill{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,#22c55e,#eab308 70%,#ef4444);transition:height .05s ease-out;width:100%}.dark body{background-color:#2E2E2E;color:#fff}.dark .panel{background-color:#353535;border-color:#555}.dark .card{background-color:#252525;border-color:#444;color:#eee}.dark input[type=range]::-webkit-slider-runnable-track{background:#555}.dark .meter-container{background:#1a1a1a;border-color:#555}.dark select,.dark input[type=text],.dark input[type=number]{background-color:#444;color:#fff;border-color:#666}</style></head><body class="bg-gray-100 h-screen flex flex-col transition-colors duration-300"><div id="splash-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm"><div class="bg-gray-100 rounded-2xl shadow-2xl p-8 w-[500px] h-[300px] flex flex-col items-center justify-between border border-gray-300"><div class="text-center mt-4"><h1 class="text-3xl font-bold text-gray-800 mb-2">Simulador de Paneo</h1><p class="text-gray-500 text-sm">Inicializando...</p></div><div class="w-full mb-4 flex flex-col items-center"><div id="progress-container" class="w-full bg-white rounded-full h-6 border border-gray-300 overflow-hidden relative"><div id="progress-bar" class="h-full bg-blue-600 w-0 transition-all duration-100 ease-linear"></div></div><button id="btn-enter" class="hidden mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-8 rounded shadow transition transform hover:scale-105">Ingresar</button></div></div></div><div id="app-container" class="flex-1 flex overflow-hidden hidden"><div class="w-[450px] flex flex-col border-r border-gray-300 panel transition-colors duration-300 bg-white shadow-lg z-10"><div class="flex border-b border-gray-300 bg-gray-50 panel"><button onclick="switchSideTab('main')" id="tab-btn-main" class="flex-1 py-2 px-4 text-sm font-semibold text-blue-600 border-b-2 border-blue-600 focus:outline-none hover:bg-gray-100 transition">Principal</button> <button onclick="switchSideTab('custom')" id="tab-btn-custom" class="flex-1 py-2 px-4 text-sm font-semibold text-gray-500 hover:text-blue-500 focus:outline-none hover:bg-gray-100 transition">Personalización</button></div><div class="flex-1 overflow-y-auto p-4 relative"><div id="tab-content-main" class="space-y-4"><fieldset class="border border-gray-300 rounded p-3 card"><legend class="px-2 text-sm font-semibold text-gray-600 dark:text-gray-300">Salida Maestra</legend><div class="flex justify-center space-x-6 items-end h-[240px] pt-2"><div class="flex flex-col items-center h-full"><span id="lbl-master-db" class="text-xs mb-2 font-mono">-inf dB</span> <input type="range" id="slider-master" min="-600" max="0" value="0" class="slider-vertical" oninput="app.updateState('master',this.value)"> <button onclick="app.updateState('master',0);document.getElementById('slider-master').value=0" class="mt-2 text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 px-2 py-1 rounded">0 dB</button></div><div class="flex space-x-2 h-[200px] mb-8"><div class="flex flex-col items-center h-full"><span id="lbl-meter-l" class="text-[10px] mb-1 font-mono">-inf</span><div class="meter-container"><div id="meter-l" class="meter-fill" style="height:0%"></div></div><span class="text-xs mt-1">Izquierda</span></div><div class="flex flex-col items-center h-full"><span id="lbl-meter-r" class="text-[10px] mb-1 font-mono">-inf</span><div class="meter-container"><div id="meter-r" class="meter-fill" style="height:0%"></div></div><span class="text-xs mt-1">Derecha</span></div></div></div></fieldset><fieldset class="border border-gray-300 rounded p-3 card"><legend class="px-2 text-sm font-semibold flex items-center gap-2 text-gray-600 dark:text-gray-300"><input type="checkbox" checked disabled class="accent-blue-500"> Controles de Paneo</legend><div class="mb-4"><div class="flex justify-between text-xs mb-1"><span>Dif. Intensidad (IID)</span> <span id="lbl-pan-val">Centro</span></div><div class="flex items-center gap-2"><span class="text-xs font-bold">I</span> <input type="range" id="slider-pan" min="-100" max="100" value="0" class="flex-1" oninput="app.updateState('pan',this.value)"> <span class="text-xs font-bold">D</span></div><div class="flex justify-center gap-2 mt-1"><button onclick="app.setPan(-100)" class="text-[10px] px-2 py-0.5 bg-gray-200 rounded dark:bg-gray-600">L</button> <button onclick="app.setPan(0)" class="text-[10px] px-2 py-0.5 bg-gray-200 rounded dark:bg-gray-600">C</button> <button onclick="app.setPan(100)" class="text-[10px] px-2 py-0.5 bg-gray-200 rounded dark:bg-gray-600">R</button></div></div><div class="mb-4"><div class="flex justify-between text-xs mb-1"><span>Retardo (ITD)</span> <span id="lbl-delay-val">0.0 ms</span></div><div class="flex items-center gap-2"><span class="text-xs font-bold">I</span> <input type="range" id="slider-delay" min="-500" max="500" value="0" class="flex-1" oninput="app.updateState('delay',this.value)"> <span class="text-xs font-bold">D</span></div><div class="text-center mt-1"><span id="lbl-haas-zone" class="text-xs text-gray-500 italic">Zona de Fusión y Paneo</span></div></div><div><label class="text-xs block mb-1">Ley de Paneo de Nivel</label> <select id="select-pan-law" class="w-full text-xs p-1 border rounded" onchange="app.updateState('panLaw',this.value)"><option value="constant_power">Potencia Constante (-3 dB)</option><option value="linear">Lineal (-6 dB)</option><option value="sqrt">Raíz Cuadrada (-4.5 dB)</option></select></div></fieldset><fieldset class="border border-gray-300 rounded p-3 card"><legend class="px-2 text-sm font-semibold flex items-center gap-2 text-gray-600 dark:text-gray-300"><input type="checkbox" id="chk-acoustics" class="accent-blue-500"> Acústica de Sala</legend><div class="flex justify-between text-xs mb-1"><span>Absorción (α)</span> <span id="lbl-absorption">0.60</span></div><div class="flex items-center gap-2"><span class="text-xs">0.0</span> <input type="range" id="slider-absorption" min="0" max="100" value="60" class="flex-1" oninput="app.updateState('absorption',this.value)"> <span class="text-xs">1.0</span></div></fieldset><fieldset class="border border-gray-300 rounded p-3 card"><legend class="px-2 text-sm font-semibold text-gray-600 dark:text-gray-300">Controles de Animación</legend><div class="flex flex-col gap-2"><div class="flex gap-2"><button id="btn-play" onclick="app.toggleAnimation()" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 py-1 px-2 rounded flex items-center justify-center gap-2 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800"><i class="fas fa-play"></i> <span>Iniciar Animación</span></button> <button id="btn-reset" onclick="app.resetSimulation()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-3 rounded dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500" title="Reiniciar"><i class="fas fa-redo"></i></button></div><div class="flex items-center justify-between text-xs"><span>Velocidad:</span><div class="flex gap-1"><button onclick="app.setSpeed(0.5)" class="btn-speed px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-100 dark:border-gray-500 dark:hover:bg-gray-600" data-speed="0.5">0.5x</button> <button onclick="app.setSpeed(1.0)" class="btn-speed px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-100 bg-blue-100 border-blue-300 dark:bg-blue-900 dark:border-blue-700" data-speed="1.0">1x</button> <button onclick="app.setSpeed(1.5)" class="btn-speed px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-100 dark:border-gray-500 dark:hover:bg-gray-600" data-speed="1.5">1.5x</button></div></div></div></fieldset><fieldset class="border border-gray-300 rounded p-3 card"><legend class="px-2 text-sm font-semibold text-gray-600 dark:text-gray-300">Motor de Audio</legend><div class="space-y-3"><div class="flex items-center gap-2"><button id="btn-audio-toggle" onclick="app.toggleAudio()" class="p-2 rounded-full bg-gray-200 text-gray-500 hover:bg-gray-300 w-10 h-10 flex items-center justify-center dark:bg-gray-600 dark:text-gray-300"><i class="fas fa-volume-mute"></i></button><div class="flex-1"><label class="text-xs block text-gray-500">Fuente:</label> <select id="select-audio-source" class="w-full text-xs p-1 border rounded mt-0.5" onchange="app.updateState('audioSource',this.value)"><option value="pink_noise">Ruido Rosa</option><option value="sine">Tono 440Hz</option><option value="metronome">Metrónomo</option></select></div></div><div><div class="flex justify-between text-xs mb-1"><span>Nivel de Fuente</span> <span id="lbl-source-level">0.0 dB</span></div><div class="flex items-center gap-2"><span class="text-xs text-gray-400">-30</span> <input type="range" id="slider-audio-level" min="-300" max="0" value="0" class="flex-1" oninput="app.updateState('sourceLevel',this.value)"> <span class="text-xs text-gray-400">0</span></div></div></div></fieldset></div><div id="tab-content-custom" class="hidden space-y-4"><fieldset class="border border-gray-300 rounded p-3 card"><legend class="px-2 text-sm font-semibold">Texto de la Esfera</legend><div class="mb-2"><label class="text-xs block mb-1">Texto:</label> <input type="text" id="txt-perceived" value="Vox" class="w-full p-1 border rounded text-sm" oninput="app.updateState('text',this.value)"></div><div class="flex gap-2"><div class="flex-1"><label class="text-xs block mb-1">Fuente:</label> <select id="sel-font" class="w-full p-1 border rounded text-sm" onchange="app.updateState('font',this.value)"><option value="Arial">Arial</option><option value="Times New Roman">Times New Roman</option><option value="Courier New">Courier New</option><option value="Verdana">Verdana</option></select></div><div class="w-20"><label class="text-xs block mb-1">Tamaño:</label> <input type="number" id="num-fontsize" value="10" min="6" max="30" class="w-full p-1 border rounded text-sm" onchange="app.updateState('fontSize',this.value)"></div></div></fieldset><fieldset class="border border-gray-300 rounded p-3 card space-y-2"><legend class="px-2 text-sm font-semibold">Colores</legend><div class="flex justify-between items-center"><span class="text-xs">Monitor Izquierdo</span> <input type="color" id="col-L" value="#007ACC" onchange="app.updateColor('speaker_L',this.value)"></div><div class="flex justify-between items-center"><span class="text-xs">Monitor Derecho</span> <input type="color" id="col-R" value="#D93939" onchange="app.updateColor('speaker_R',this.value)"></div><div class="flex justify-between items-center"><span class="text-xs">Oyente</span> <input type="color" id="col-listener" value="#4A4A4A" onchange="app.updateColor('listener',this.value)"></div><div class="flex justify-between items-center"><span class="text-xs">Posición Percibida</span> <input type="color" id="col-perceived" value="#FF8C00" onchange="app.updateColor('perceived',this.value)"></div><div class="flex justify-between items-center"><span class="text-xs">Fondo/Cuadrícula</span> <input type="color" id="col-bg" value="#FFFFFF" onchange="app.updateColor('background',this.value)"></div></fieldset></div></div></div><div class="flex-1 flex flex-col bg-white panel transition-colors duration-300 relative"><div class="h-8 border-b border-gray-300 flex items-center px-2 bg-gray-100 text-xs gap-4 panel dark:bg-gray-800 dark:border-gray-600"><div class="cursor-pointer hover:bg-gray-200 px-2 py-1 rounded dark:hover:bg-gray-700">Archivo</div><div class="cursor-pointer hover:bg-gray-200 px-2 py-1 rounded dark:hover:bg-gray-700 group relative">Visualización<div class="hidden group-hover:block absolute top-full left-0 bg-white border shadow-lg w-32 py-1 z-50 dark:bg-gray-700 dark:border-gray-600"><div class="px-4 py-1 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer flex justify-between" onclick="app.setTheme('light')">Tema Claro <i id="chk-light" class="fas fa-check text-xs"></i></div><div class="px-4 py-1 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer flex justify-between" onclick="app.setTheme('dark')">Tema Oscuro <i id="chk-dark" class="fas fa-check text-xs hidden"></i></div></div></div></div><div class="flex border-b border-gray-300 bg-gray-50 panel"><button onclick="switchVisTab('scene')" id="vis-btn-scene" class="py-1 px-4 text-xs font-semibold text-blue-600 border-b-2 border-blue-600 focus:outline-none">Escena</button> <button onclick="switchVisTab('analysis')" id="vis-btn-analysis" class="py-1 px-4 text-xs font-semibold text-gray-500 hover:text-blue-500 focus:outline-none">Análisis</button></div><div class="flex-1 relative overflow-hidden bg-white dark:bg-[#2E2E2E]" id="canvas-wrapper"><div id="vis-content-scene" class="absolute inset-0 flex items-center justify-center"><canvas id="scene-canvas"></canvas></div><div id="vis-content-analysis" class="absolute inset-0 flex flex-col hidden p-2"><div class="flex-1 border border-dashed border-gray-300 m-1 relative rounded dark:border-gray-600"><span class="absolute top-1 left-2 text-xs text-gray-500">Goniometro</span> <canvas id="gonio-canvas" class="w-full h-full"></canvas></div><div class="flex-1 border border-dashed border-gray-300 m-1 relative rounded dark:border-gray-600"><span class="absolute top-1 left-2 text-xs text-gray-500">Analizador de Espectro</span> <canvas id="spec-canvas" class="w-full h-full"></canvas></div></div></div></div></div><script>
(()=>{const M=Math,D=document,W=window,GE=1.15,MS=1.15,MHD=50,WRS=1.15,MN=-60,MX=0;const _S={m:0,p:0,d:0,pl:'constant_power',a:.6,src:'pink_noise',sl:0,ia:!1,ir:!1,asp:1,c:{L:'#007ACC',R:'#D93939',li:'#4A4A4A',pe:'#FF8C00',bg:'#FFFFFF',g:'#DDDDDD',t:'#000000',ar:'black'},pt:'Vox',ff:'Arial',fs:10,g:{s:10*GE,h:0,spL:{x:0,y:0},spR:{x:0,y:0},li:{x:0,y:0},pe:{x:0,y:0}}};_S.g.h=(M.sqrt(3)/2)*_S.g.s;_S.g.spL={x:-_S.g.s/2,y:_S.g.h*(2/3)};_S.g.spR={x:_S.g.s/2,y:_S.g.h*(2/3)};_S.g.li={x:0,y:-_S.g.h/3};class _A{constructor(){this.c=null;this.n={};this.an=null;this.b=null}async i(){if(this.c)return;this.c=new(W.AudioContext||W.webkitAudioContext);this.n.m=this.c.createChannelMerger(2);this.n.mg=this.c.createGain();this.an=this.c.createAnalyser();this.an.fftSize=2048;this.n.m.connect(this.an);this.an.connect(this.n.mg);this.n.mg.connect(this.c.destination);this.n.ig=this.c.createGain();this.n.gL=this.c.createGain();this.n.dL=this.c.createDelay(1);this.n.gR=this.c.createGain();this.n.dR=this.c.createDelay(1);this.n.ig.connect(this.n.gL);this.n.ig.connect(this.n.gR);this.n.gL.connect(this.n.dL);this.n.dL.connect(this.n.m,0,0);this.n.gR.connect(this.n.dR);this.n.dR.connect(this.n.m,0,1);this.pn=_cpn(this.c,5);this.mb=_cmc(this.c)}_ss(){if(this.n.s){try{this.n.s.stop()}catch(e){}this.n.s.disconnect()}let s;if(_S.src==='pink_noise'){s=this.c.createBufferSource();s.buffer=this.pn;s.loop=!0}else if(_S.src==='sine'){s=this.c.createOscillator();s.type='sine';s.frequency.value=440}else if(_S.src==='metronome'){const bl=60/120,bf=this.c.createBuffer(1,this.c.sampleRate*bl,this.c.sampleRate),d=bf.getChannelData(0),cl=this.mb.getChannelData(0);for(let i=0;i<cl.length&&i<d.length;i++)d[i]=cl[i];s=this.c.createBufferSource();s.buffer=bf;s.loop=!0}this.n.s=s;s.connect(this.n.ig);s.start()}_st(){if(this.n.s)try{this.n.s.stop()}catch(e){}}_up(){if(!this.c)return;const n=this.c.currentTime,sg=M.pow(10,_S.sl/20),mg=M.pow(10,_S.m/20);this.n.ig.gain.setTargetAtTime(sg,n,.02);this.n.mg.gain.setTargetAtTime(mg,n,.02);let aL,aR;const pp=(_S.p/100+1)/2;if(_S.pl==='linear'){aL=1-pp;aR=pp}else if(_S.pl==='sqrt'){const an=pp*M.PI/2,cL=M.cos(an),cR=M.sin(an);aL=(cL+(1-pp))/2;aR=(cR+pp)/2}else{const an=pp*M.PI/2;aL=M.cos(an);aR=M.sin(an)}this.n.gL.gain.setTargetAtTime(aL,n,.02);this.n.gR.gain.setTargetAtTime(aR,n,.02);const dS=_S.d/1000;let dL=0,dR=0;if(_S.d>0){dL=M.abs(dS);dR=0}else{dL=0;dR=M.abs(dS)}this.n.dL.delayTime.setTargetAtTime(dL,n,.02);this.n.dR.delayTime.setTargetAtTime(dR,n,.02)}_gl(){if(!this.an||!_S.ia)return{l:-100,r:-100};const iR=_S.ia?M.pow(10,_S.sl/20):0,mG=M.pow(10,_S.m/20),gL=this.n.gL.gain.value,gR=this.n.gR.gain.value,rL=iR*gL*mG,rR=iR*gR*mG;return{l:20*M.log10(rL+1e-5),r:20*M.log10(rR+1e-5)}}}function _cpn(c,d){const s=c.sampleRate*d,b=c.createBuffer(1,s,c.sampleRate),dt=b.getChannelData(0);let z=[0,0,0,0,0,0,0];for(let i=0;i<s;i++){const w=M.random()*2-1;z[0]=.99886*z[0]+w*.0555179;z[1]=.99332*z[1]+w*.0750759;z[2]=.969*z[2]+w*.153852;z[3]=.8665*z[3]+w*.3104856;z[4]=.55*z[4]+w*.5329522;z[5]=-.7616*z[5]-w*.016898;dt[i]=z.reduce((a,v)=>a+v,0)+z[6]+w*.5362;dt[i]*=.11;z[6]=w*.115926}return b}function _cmc(c){const d=.04,s=c.sampleRate*d,b=c.createBuffer(1,s,c.sampleRate),dt=b.getChannelData(0);for(let i=0;i<s;i++){const t=i/c.sampleRate;dt[i]=M.sin(2*M.PI*1000*t)*M.exp(-t*200)*.9}return b}const ae=new _A;_V={sc:D.getElementById('scene-canvas'),gc:D.getElementById('gonio-canvas'),sp:D.getElementById('spec-canvas'),ic(c){const r=c.parentElement.getBoundingClientRect();c.width=r.width;c.height=r.height;return c.getContext('2d')},ds(t){const c=this.ic(this.sc),w=this.sc.width,h=this.sc.height,cx=w/2,cy=h/2;c.fillStyle=_S.c.bg;c.fillRect(0,0,w,h);c.strokeStyle=_S.c.g;c.beginPath();c.moveTo(cx,0);c.lineTo(cx,h);c.moveTo(0,cy);c.lineTo(w,cy);c.stroke();const sc=M.min(w,h)/(25*GE),tp=p=>({x:cx+p.x*sc,y:cy-p.y*sc}),sL=tp(_S.g.spL),sR=tp(_S.g.spR),li=tp(_S.g.li),tm=-_S.d/MHD,tt=M.max(-1,M.min(1,(_S.p/100)+tm)),cen={x:(sL.x+sR.x)/2,y:(sL.y+sR.y)/2},dst=M.hypot(cen.x-li.x,cen.y-li.y),ma=M.PI/3,pp={x:li.x+dst*M.sin(tt*ma*-1),y:li.y-dst*M.cos(tt*ma*-1)};c.strokeStyle=_S.c.ar;c.setLineDash([5,5]);c.beginPath();c.arc(li.x,li.y,dst,M.PI+M.PI/6,2*M.PI-M.PI/6);c.stroke();c.setLineDash([]);const dw=(o,tm,cl)=>{const ws=15,mr=20*WRS;for(let i=0;i<5;i++){const st=i*mr/(5*ws);if(tm>st){const r=((tm-st)*ws)%mr,al=M.max(0,1-(r/mr)**2);if(al>0){c.beginPath();c.arc(o.x,o.y,r*sc,0,2*M.PI);c.strokeStyle=cl;c.globalAlpha=al;c.lineWidth=2;c.stroke();c.globalAlpha=1}}}},dS=_S.d/1000;dw(sL,t+M.max(0,-dS),_S.c.L);dw(sR,t+M.max(0,dS),_S.c.R);c.fillStyle=_S.c.li;const hz=1.2*MS*sc;c.beginPath();c.roundRect(li.x-hz/2,li.y-hz/2,hz,hz,5);c.fill();const sz=10;c.fillStyle=_S.c.L;c.beginPath();c.arc(sL.x,sL.y,sz,0,2*M.PI);c.fill();c.fillStyle=_S.c.t;c.font="12px Arial";c.fillText("L",sL.x-3,sL.y+20);c.fillStyle=_S.c.R;c.beginPath();c.arc(sR.x,sR.y,sz,0,2*M.PI);c.fill();c.fillStyle=_S.c.t;c.fillText("R",sR.x-3,sR.y+20);const pSc=M.pow(M.max(0,(_S.m-MN)/(MX-MN)),.75),pZ=(20+5*M.sin(t*5))*pSc;c.fillStyle=_S.c.pe;c.beginPath();c.arc(pp.x,pp.y,M.max(2,pZ),0,2*M.PI);c.fill();if(pZ>2){c.fillStyle="white";c.font=`${_S.fs}px ${_S.ff}`;c.textAlign="center";c.textBaseline="middle";c.fillText(_S.pt,pp.x,pp.y)}},da(){if(D.getElementById('vis-content-analysis').classList.contains('hidden'))return;const cg=this.ic(this.gc),wg=this.gc.width,hg=this.gc.height;cg.fillStyle=_S.c.bg;cg.fillRect(0,0,wg,hg);cg.strokeStyle=_S.c.g;cg.beginPath();cg.moveTo(wg/2,0);cg.lineTo(wg/2,hg);cg.stroke();cg.beginPath();cg.moveTo(0,hg/2);cg.lineTo(wg,hg/2);cg.stroke();if(_S.ia){const p=_S.p/100,sp=50*(1-M.abs(p)*.5),an=-M.PI/4+(p*M.PI/4);cg.fillStyle=_S.c.pe;for(let i=0;i<100;i++){const r=M.random()*sp,th=M.random()*2*M.PI,x=r*M.cos(th),y=r*M.sin(th)*(1-M.abs(p)),xr=x*M.cos(an)-y*M.sin(an),yr=x*M.sin(an)+y*M.cos(an);cg.beginPath();cg.arc(wg/2+xr,hg/2+yr,1,0,2*M.PI);cg.fill()}}const cs=this.ic(this.sp),ws=this.sp.width,hs=this.sp.height;cs.fillStyle=_S.c.bg;cs.fillRect(0,0,ws,hs);cs.strokeStyle=_S.c.g;cs.setLineDash([2,2]);for(let i=1;i<5;i++){const x=i*ws/5;cs.beginPath();cs.moveTo(x,0);cs.lineTo(x,hs);cs.stroke()}cs.setLineDash([]);if(_S.ia&&ae.an){const bl=ae.an.frequencyBinCount,da=new Uint8Array(bl);ae.an.getByteFrequencyData(da);cs.lineWidth=2;cs.strokeStyle=_S.c.L;cs.beginPath();const sw=ws*1/bl;let x=0;for(let i=0;i<bl;i++){const v=da[i]/255,y=hs-(v*hs);i===0?cs.moveTo(x,y):cs.lineTo(x,y);x+=sw}cs.stroke()}}};const _C={async i(){await ae.i();let p=0;const b=D.getElementById('progress-bar'),iv=setInterval(()=>{p+=2;b.style.width=p+'%';if(p>=100){clearInterval(iv);D.getElementById('progress-container').classList.add('hidden');D.getElementById('btn-enter').classList.remove('hidden')}},60)},async e(){if(ae.c&&ae.c.state==='suspended')await ae.c.resume();D.getElementById('splash-screen').classList.add('hidden');D.getElementById('app-container').classList.remove('hidden');_C.uU();_C.sL()},uS(k,v){if(['master','pan','delay','absorption','sourceLevel','fontSize'].includes(k))v=parseFloat(v);if(k==='master')_S.m=v/10;if(k==='pan')_S.p=v;if(k==='delay')_S.d=v/10;if(k==='panLaw')_S.pl=v;if(k==='absorption')_S.a=v/100;if(k==='audioSource'){_S.src=v;if(_S.ia)ae._ss()}if(k==='sourceLevel')_S.sl=v/10;if(k==='text')_S.pt=v;if(k==='font')_S.ff=v;if(k==='fontSize')_S.fs=parseInt(v);ae._up();_C.uU()},setPan(v){D.getElementById('slider-pan').value=v;_C.uS('pan',v)},updateColor(k,h){_S.c[k]=h;if(k==='background'){const r=parseInt(h.substr(1,2),16),g=parseInt(h.substr(3,2),16),b=parseInt(h.substr(5,2),16),l=0.2126*r+0.7152*g+0.0722*b;if(l<128)_C.sT('dark');else _C.sT('light');_S.c.g=l<128?'#555555':'#DDDDDD';_S.c.t=l<128?'#FFFFFF':'#000000';_S.c.ar=l<128?'#CCCCCC':'black'}},toggleAudio(){_S.ia=!_S.ia;const b=D.getElementById('btn-audio-toggle');if(_S.ia){b.classList.replace('text-gray-500','text-green-600');b.classList.add('bg-green-100');b.innerHTML='<i class="fas fa-volume-up"></i>';ae._ss()}else{b.classList.replace('text-green-600','text-gray-500');b.classList.remove('bg-green-100');b.innerHTML='<i class="fas fa-volume-mute"></i>';ae._st()}ae._up()},toggleAnimation(){_S.ir=!_S.ir;const b=D.getElementById('btn-play');b.innerHTML=_S.ir?'<i class="fas fa-pause"></i> <span>Detener Animación</span>':'<i class="fas fa-play"></i> <span>Iniciar Animación</span>'},resetSimulation(){_S.m=0;_S.p=0;_S.d=0;_S.pl='constant_power';_S.a=.6;_S.ir=!1;_S.ia=!1;D.getElementById('slider-master').value=0;D.getElementById('slider-pan').value=0;D.getElementById('slider-delay').value=0;D.getElementById('slider-absorption').value=60;D.getElementById('select-pan-law').value='constant_power';_C.uS('master',0);_C.uS('pan',0);_C.uS('delay',0);ae._st();_C.toggleAnimation();if(!_S.ir)D.getElementById('btn-play').innerHTML='<i class="fas fa-play"></i> <span>Iniciar Animación</span>';const b=D.getElementById('btn-audio-toggle');b.classList.replace('text-green-600','text-gray-500');b.classList.remove('bg-green-100');b.innerHTML='<i class="fas fa-volume-mute"></i>';_C.uU()},setSpeed(s){_S.asp=s;D.querySelectorAll('.btn-speed').forEach(b=>{b.classList.remove('bg-blue-100','border-blue-300','dark:bg-blue-900','dark:border-blue-700');if(parseFloat(b.dataset.speed)===s)b.classList.add('bg-blue-100','border-blue-300','dark:bg-blue-900','dark:border-blue-700')})},sT(t){if(t==='dark'){D.documentElement.classList.add('dark');D.getElementById('chk-dark').classList.remove('hidden');D.getElementById('chk-light').classList.add('hidden');_S.c.bg='#2E2E2E';_S.c.t='#FFFFFF';_S.c.g='#555555';_S.c.ar='#CCCCCC'}else{D.documentElement.classList.remove('dark');D.getElementById('chk-dark').classList.add('hidden');D.getElementById('chk-light').classList.remove('hidden');_S.c.bg='#FFFFFF';_S.c.t='#000000';_S.c.g='#DDDDDD';_S.c.ar='black'}},uU(){D.getElementById('lbl-master-db').innerText=_S.m>-60?_S.m.toFixed(1)+" dB":"-inf dB";const pt=_S.p===0?"Centro":`${M.abs(_S.p)}% ${_S.p<0?'Izquierda':'Derecha'}`;D.getElementById('lbl-pan-val').innerText=pt;const dt=M.abs(_S.d)<.1?"0.0 ms":`${M.abs(_S.d).toFixed(1)} ms (${_S.d<0?'I':'D'} ad.)`;D.getElementById('lbl-delay-val').innerText=dt;let z="Fusión y Paneo";if(M.abs(_S.d)>30)z="Reflexión Discreta";else if(M.abs(_S.d)>5)z="Amplitud Estéreo";D.getElementById('lbl-haas-zone').innerText=`Zona de ${z}`;D.getElementById('lbl-absorption').innerText=_S.a.toFixed(2);D.getElementById('lbl-source-level').innerText=_S.sl.toFixed(1)+" dB"},sL(){let lt=0,at=0;const l=ts=>{const dt=(ts-lt)/1000;lt=ts;if(_S.ir)at+=.03*_S.asp;const lv=ae._gl(),cl=v=>M.min(100,M.max(0,(v-MN)/(MX-MN)*100));D.getElementById('meter-l').style.height=cl(lv.l)+'%';D.getElementById('meter-r').style.height=cl(lv.r)+'%';D.getElementById('lbl-meter-l').innerText=lv.l>-60?lv.l.toFixed(0):'-inf';D.getElementById('lbl-meter-r').innerText=lv.r>-60?lv.r.toFixed(0):'-inf';_V.ds(at);_V.da();requestAnimationFrame(l)};requestAnimationFrame(l)}};W.app={init:_C.i,enter:_C.e,updateState:_C.uS,setPan:_C.setPan,updateColor:_C.updateColor,toggleAudio:_C.toggleAudio,toggleAnimation:_C.toggleAnimation,resetSimulation:_C.resetSimulation,setSpeed:_C.setSpeed,setTheme:_C.sT};W.switchSideTab=t=>{D.getElementById('tab-content-main').classList.add('hidden');D.getElementById('tab-content-custom').classList.add('hidden');D.getElementById('tab-content-'+t).classList.remove('hidden');const m=D.getElementById('tab-btn-main'),c=D.getElementById('tab-btn-custom');m.className=c.className="flex-1 py-2 px-4 text-sm font-semibold text-gray-500 hover:text-blue-500 focus:outline-none hover:bg-gray-100 transition";D.getElementById('tab-btn-'+t).className="flex-1 py-2 px-4 text-sm font-semibold text-blue-600 border-b-2 border-blue-600 focus:outline-none hover:bg-gray-100 transition"};W.switchVisTab=t=>{D.getElementById('vis-content-scene').classList.add('hidden');D.getElementById('vis-content-analysis').classList.add('hidden');D.getElementById('vis-content-'+t).classList.remove('hidden');const s=D.getElementById('vis-btn-scene'),a=D.getElementById('vis-btn-analysis');s.className=a.className="py-1 px-4 text-xs font-semibold text-gray-500 hover:text-blue-500 focus:outline-none";D.getElementById('vis-btn-'+t).className="py-1 px-4 text-xs font-semibold text-blue-600 border-b-2 border-blue-600 focus:outline-none"};D.getElementById('btn-enter').onclick=app.enter;app.init()})();
</script></body></html>